'use strict';

var getLocation = function getLocation(timeout, cb) {
	if ('function' === typeof timeout) {
		cb = timeout;
		timeout = 10000;
	}

	if (!navigator && !navigator.geolocation) {
		return cb(new Error('geolocation api not supported'));
	}

	var succeeded = false;
	var onSuccess = function onSuccess(loc) {
		if (succeeded) return;
		succeeded = true;
		cb(null, {
			latitude: loc.coords.latitude,
			longitude: loc.coords.longitude,
			accuracy: loc.coords.accuracy,
			native: true
		});
	};
	var onError = function onError(err) {
		return cb(err || new Error('unknown error'));
	};

	navigator.geolocation.getCurrentPosition(onSuccess, onError);
	setTimeout(function () {
		if (!succeeded) cb(new Error('timeout'));
	}, timeout);
};

module.exports = getLocation;